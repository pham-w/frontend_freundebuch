<script>
    const el = (t,a={},h='')=>{
        const n=document.createElement(t);
        Object.entries(a).forEach(([k,v])=>n.setAttribute(k,v));
        if(h) n.innerHTML=h;
        return n;
    };

    const fmtDate = iso => {
        if(!iso) return "";
        const [y,m,d] = iso.split("-");
        return `${d}.${m}.${y}`;
    };

    const book=document.getElementById('book');
    const prevBtn=document.getElementById('prevBtn');
    const nextBtn=document.getElementById('nextBtn');
    const hotLeft=document.getElementById('hotLeft');
    const hotRight=document.getElementById('hotRight');
    const cover=document.getElementById('cover');

    let pages=[];
    let pageIndex=-1; // -1 = Cover

    function setState(){
        const coverVisible = (pageIndex < 0);
        cover.style.display = coverVisible ? 'flex' : 'none';

        pages.forEach((p,i)=>{
            p.style.display = coverVisible ? 'none' : 'block';
            p.classList.toggle('flipped', i < pageIndex);
        });

        prevBtn.disabled = (pageIndex < 0);
        nextBtn.disabled = (pageIndex >= pages.length);
    }

    function goNext(){ if(pageIndex < pages.length){ pageIndex++; setState(); } }
    function goPrev(){ if(pageIndex >= 0){ pageIndex--; setState(); } }

    prevBtn.onclick = goPrev;
    nextBtn.onclick = goNext;
    hotLeft.onclick = goPrev;
    hotRight.onclick = goNext;

    window.onkeydown = e => {
        if(e.key === "ArrowRight") goNext();
        if(e.key === "ArrowLeft") goPrev();
    };

    function makePage(person){
        const html = `
      <div class="kicker">Profil</div>
      <h2 class="title">${person.name ?? ""}</h2>

      <div class="grid">
        <div><div class="label">Alter</div><div class="value">${person.age ?? ""}</div></div>
        <div><div class="label">Geburtsdatum</div><div class="value">${fmtDate(person.geburtsdatum)}</div></div>
        <div><div class="label">Lieblingsfarbe</div><div class="value">${person.favColor ?? ""}</div></div>
        <div><div class="label">Hobby</div><div class="value">${person.hobby ?? ""}</div></div>
        <div><div class="label">Lieblingsessen</div><div class="value">${person.favFood ?? ""}</div></div>
        <div><div class="label">Traumberuf</div><div class="value">${person.dreamJob ?? ""}</div></div>
      </div>
      <div class="footer">Seite</div>
    `;
        const p = el("section", { class: "page" }, html);
        p.style.zIndex = 1000 - pages.length;
        return p;
    }

    // ðŸ”¥ Daten vom Backend holen
    fetch("https://webtech-projekt-1-p0l3.onrender.com/seite")
        .then(r => {
            if(!r.ok) throw new Error("HTTP " + r.status);
            return r.json();
        })
        .then(list => {
            if(!Array.isArray(list)) list=[list];
            list.forEach(person => {
                const page = makePage(person);
                book.appendChild(page);
                pages.push(page);
            });
            pageIndex = -1;
            setState();
        })
        .catch(err => {
            console.error(err);
            alert("Fehler beim Laden der Daten: " + err.message);
        });
</script>
